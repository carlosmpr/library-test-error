---
  title: 'AngularTestFile.ts'
  description: 'component description'
  pubDate: 'August 1, 2024'
  author: 'Carlos Polanco'
  ---
  
  
  
  # AngularTestFile.ts
  ## コードの概要

このコードは、Angularアプリケーション内でファイルのドラッグ＆ドロップを処理するためのコンポーネントです。ファイルの選択やエラーの処理を行います。

### 使用法
- ファイルをドラッグしてドロップすると、ファイルが選択されます。
- ファイル選択時には、許可された拡張子のファイルのみが選択されます。
- 最大ファイル数を超える場合はエラーが表示されます。

### 依存関係
- Angular Coreから`Component`、`EventEmitter`、`Output`をインポートしています。

## 依存関係

- Angular Coreから`Component`、`EventEmitter`、`Output`をインポートしています。
  
  ## Component Code
  ```jsx
  import { Component, EventEmitter, Output } from '@angular/core';

@Component({
  selector: 'app-file-drop-zone',
  templateUrl: './file-drop-zone.component.html',
  styleUrls: ['./file-drop-zone.component.css']
})
export class FileDropZoneComponent {
  @Output() selectedFiles = new EventEmitter<File[]>();
  @Output() setError = new EventEmitter<string>();

  allowedExtensions = [
    ".js", ".jsx", ".ts", ".tsx", ".py", ".java", ".rb", ".php",
    ".html", ".css", ".cpp", ".c", ".go", ".rs", ".swift", ".kt",
    ".m", ".h", ".cs", ".json", ".xml", ".sh", ".yml", ".yaml",
    ".vue", ".svelte", ".qwik"
  ];
  maxFiles = 4;

  handleDragOver(event: DragEvent) {
    event.preventDefault();
  }

  handleDrop(event: DragEvent) {
    event.preventDefault();
    const items = event.dataTransfer.items;
    this.extractFiles(items).then(files => this.validateAndSetFiles(files));
  }

  async extractFiles(items: DataTransferItemList): Promise<File[]> {
    const filesArray: File[] = [];
    for (let i = 0; i < items.length; i++) {
      const item = items[i].webkitGetAsEntry();
      if (item.isFile) {
        const file = await new Promise<File>((resolve) => item.file(resolve));
        if (this.isValidFile(file)) {
          filesArray.push(file);
        } else {
          this.setError.emit(`Invalid file type. Only ${this.allowedExtensions.join(", ")} files are allowed.`);
        }
      } else if (item.isDirectory) {
        await this.traverseFileTree(item, filesArray);
      }
    }
    return filesArray;
  }

  traverseFileTree(item: any, filesArray: File[]): Promise<void> {
    return new Promise((resolve) => {
      if (item.isFile) {
        item.file((file: File) => {
          if (this.isValidFile(file)) {
            filesArray.push(file);
          }
          resolve();
        });
      } else if (item.isDirectory) {
        const dirReader = item.createReader();
        dirReader.readEntries(async (entries: any[]) => {
          for (const entry of entries) {
            await this.traverseFileTree(entry, filesArray);
          }
          resolve();
        });
      }
    });
  }

  isValidFile(file: File): boolean {
    return this.allowedExtensions.some(ext => file.name.endsWith(ext));
  }

  handleFileSelect(event: Event) {
    const input = event.target as HTMLInputElement;
    const files = Array.from(input.files);
    this.validateAndSetFiles(files);
  }

  validateAndSetFiles(files: File[]) {
    const filteredFiles = files.filter(file => this.isValidFile(file));
    if (filteredFiles.length > this.maxFiles) {
      this.setError.emit(`You can only upload a maximum of ${this.maxFiles} files.`);
    } else {
      this.selectedFiles.emit(filteredFiles.slice(0, this.maxFiles));
      this.setError.emit("");
    }
  }
}
  ```
  